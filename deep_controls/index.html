
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Enabled by Jax">
      
      
        <meta name="author" content="Patrick Power">
      
      
        <link rel="canonical" href="https://pharringtonp19.github.io/rfp/deep_controls/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.2">
    
    
      
        <title>Deep controls - Regularizing the Forward Pass</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
      
  
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--code:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="m414.8 40.79-128 448.01c-4.9 17-22.6 26.8-39.6 22-17-4.9-26.8-22.6-22-39.6l128-447.99c4.9-16.994 22.6-26.834 39.6-21.978 17 4.855 26.8 22.568 22 39.558zm103.8 80.61 112 112c12.5 12.5 12.5 32.7 0 45.2l-112 112c-12.5 12.5-32.7 12.5-45.2 0s-12.5-32.7 0-45.2l89.3-89.4-89.3-89.4c-12.5-12.5-12.5-32.7 0-45.2s32.7-12.5 45.2 0zm-352 45.2L77.25 256l89.35 89.4c12.5 12.5 12.5 32.7 0 45.2s-32.7 12.5-45.2 0L9.372 278.6c-12.496-12.5-12.496-32.7 0-45.2l112.028-112c12.5-12.5 32.7-12.5 45.2 0s12.5 32.7 0 45.2z"/></svg>');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 0 1 .25-.25h5.025a.25.25 0 0 1 .177.073l6.25 6.25a.25.25 0 0 1 0 .354l-5.025 5.025a.25.25 0 0 1-.354 0l-6.25-6.25a.25.25 0 0 1-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775zM6 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>');}</style>

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#regression-framework" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Regularizing the Forward Pass" class="md-header__button md-logo" aria-label="Regularizing the Forward Pass" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Regularizing the Forward Pass
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deep controls
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Regularizing the Forward Pass
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../papers/Generalizing_Across_Clusters.pdf" class="md-tabs__link">
      Generalizing Across Clusters
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../papers/RTC.pdf" class="md-tabs__link">
      The Consequences of Right to Counsel
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../papers/Score_Guided_Attention.pdf" class="md-tabs__link">
      Score Guided Attention
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../Implementation/How%20to%20Train%20Your%20RFP/" class="md-tabs__link">
        Implementation (JAX)
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Regularizing the Forward Pass" class="md-nav__button md-logo" aria-label="Regularizing the Forward Pass" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Regularizing the Forward Pass
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Regularizing the Forward Pass
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../papers/Generalizing_Across_Clusters.pdf" class="md-nav__link">
        Generalizing Across Clusters
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../papers/RTC.pdf" class="md-nav__link">
        The Consequences of Right to Counsel
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../papers/Score_Guided_Attention.pdf" class="md-nav__link">
        Score Guided Attention
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_5">
          Implementation (JAX)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Implementation (JAX)" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Implementation (JAX)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/How%20to%20Train%20Your%20RFP/" class="md-nav__link">
        How to Train Your RFP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/networks/" class="md-nav__link">
        Neural Network Models
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/train/" class="md-nav__link">
        Training
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/losses/" class="md-nav__link">
        Losses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/data/" class="md-nav__link">
        Toy Data Sets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/featuremap/" class="md-nav__link">
        Feature Map
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Implementation/kernels/" class="md-nav__link">
        Kernels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


  <h1>Deep controls</h1>

<div class="admonition tldr">
<p class="admonition-title">Overview</p>
<p>We're going to estimate linear models via fitting non-linear models </p>
</div>
<p>How do we "evolve" the partially linear model towards a non-parametric model?</p>
<details class="tip">
<summary>What's In Between?</summary>
<ul>
<li>"De-meaning the estimates" as in a partially linear model </li>
<li>Reweighting observations as in a fully nonparametric model</li>
</ul>
</details>
<h4 id="regression-framework"><strong>Regression Framework</strong></h4>
<ul>
<li>You can think of the regression framework as averaging across <span class="arithmatex">\(n\)</span> randomized controls trials centered on <span class="arithmatex">\(x\)</span> with one observation in each trial with no correction/adjustment for the conditional distribution: <span class="arithmatex">\(\mathbb{P}(D|X)\)</span></li>
</ul>
<div class="arithmatex">\[\begin{align*} 
\hat{\theta} &amp;= \underset{\theta}{\text{argmin}} \ 
\sum _i \big(v_i -\theta u_i)\big)^2\end{align*}\]</div>
<p>where</p>
<ul>
<li><span class="arithmatex">\(v_i = y_i - f_1(x_i)\)</span></li>
<li><span class="arithmatex">\(u_i= d_i - f_2(x_i)\)</span></li>
<li><span class="arithmatex">\(f_1(x_i) = E[Y|X=x]\)</span></li>
<li><span class="arithmatex">\(f_2(x_i) = E[D|X=x]\)</span></li>
</ul>
<details class="note">
<summary>Causal Inference</summary>
<ul>
<li>Statistical Learning Theory: "If it turns out that nevertheless we can explain the data at hand, then we have reason to believe that we have found a regularity underlying the data."</li>
</ul>
</details>
<h4 id="our-gradient-correction-approach"><strong>Our Gradient Correction Approach</strong></h4>
<div class="arithmatex">\[ \begin{align*}  E[Y|X] &amp;= \beta ^T \phi(X) \\ 
&amp;= \int Y(D)d\mathbb{P}(D|X) \\
E[Y|D,X] &amp;= \theta^TD + E[Y|X] \end{align*} \]</div>
<p>We incorporate the regularizing strategy proposed in <a href="https://arxiv.org/abs/2007.04504">Learning Differential Equations that are Easy to Solve
</a>  </p>
<figure>
<p><img alt="Image title" src="./../fig/reg_ode_0.0.png" width="700" />
<img alt="Image title" src="./../fig/reg_ode_10.0.png" width="700" /></p>
<figcaption>Visual Effect of Regularizing</figcaption>
</figure>
<details class="tip">
<summary>Abstract Algebra</summary>
<ul>
<li>Sets</li>
<li>Group (functions defined on this set)</li>
</ul>
<p>What structure on <span class="arithmatex">\(\mathbb{R}^n\)</span> should we preserve? </p>
<div class="arithmatex">\[\begin{align*} g : {\text{bijections}} \to \mathbb{R^n} \to \mathbb{R^n} \end{align*}  \equiv \text{Sym}(\mathbb{R}^n)\]</div>
</details>
<p>We don't assume cross-sectional selection on observables:</p>
<div class="arithmatex">\[ Y_i(d, 1) \perp D_i | X_i  \quad \forall d \]</div>
<p>We assume de-panelled selection<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> on observables:</p>
<div class="arithmatex">\[Y_i(d,1) - Y_i(0, 0) \perp D_i \big | X_i \quad \forall d \]</div>
<p>This assumption provides justification for interpreting <span class="arithmatex">\(\beta_1\)</span> as the causal effect:</p>
<div class="arithmatex">\[\begin{align*} Y_{1,i} - Y_{0,i} &amp;= \beta_0 + \beta_1 D_i +  \varepsilon _i  \\  
Y_{1,i}  &amp;= \beta_0 + \beta_1 D_i + Y_{0,i} +  \varepsilon _i \end{align*} \]</div>
<!-- ??? Warning inline end "Double Machine Learning Example"

    <figure markdown>
    ![Image title](./../fig/dml.png){ width="500" }
    <figcaption>Normalized Sampling Distribution</figcaption>
    </figure> -->
<p>In practice, we don't usually condition on <span class="arithmatex">\(X_i\)</span> (which means there's no reason to correct for <span class="arithmatex">\(\mathbb{P}(D|X)\)</span>, and this is very attractive because we know that the partially linear model fails to correct for this! --&gt; See <a href="./examples.md">Double Machine Learning Example</a>)
and we allow </p>
<div class="arithmatex">\[Y_{0, i} \approx f(X_i, D_i) \]</div>
<p>But in some sense, this kinda feels like cheating because it suggests that de-panelled selection on observables is easier to work with than cross-sectional selection on observables. </p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>Repeated cross-section&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>




              
            </article>
            
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant", "navigation.tabs", "navigation.indexes", "toc.integrate", "navigation.top"], "search": "../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
        <script src="../_static/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>